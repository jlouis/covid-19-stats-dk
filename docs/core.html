<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2022-01-31" />

<title>Core Covid-19 Stats for Denmark</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Covid-19 Stats for Denmark</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="core.html">New development</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Core Covid-19 Stats for Denmark</h1>
<h4 class="date">2022-01-31</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#covid-19-stats-for-denmark">Covid 19 Stats for Denmark</a>
<ul>
<li><a href="#how-data-is-read-and-handled">How data is read and handled</a>
<ul>
<li><a href="#case-estimation-of-rt">Case Estimation of R<sub>t</sub></a></li>
<li><a href="#municipality-cases-and-tests-as-a-time-series">Municipality cases and tests as a time series</a></li>
</ul></li>
<li><a href="#plots-of-interest">Plots of interest</a>
<ul>
<li><a href="#cases-in-different-municipalities">Cases in different municipalities</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<div id="covid-19-stats-for-denmark" class="section level1">
<h1>Covid 19 Stats for Denmark</h1>
<p>This file provides the new development of Covid-19 stats. Where the original development took its data from the SSI Covid-19 Dashboard, this takes data in the form of the “raw” core data.</p>
<p>One early important part of the process is to define a date range of interest. The current variant we are interested in is Omicron, so, we can focus on recent data, rather than the full period:</p>
<pre class="r"><code>low_cutoff &lt;- &quot;2021-12-01&quot;</code></pre>
<p>Likewise, some files contain a date at which they were produced. For instance the estimation of R<sub>t</sub>:</p>
<pre class="r"><code>rt_date &lt;- &quot;2022_02_01&quot;</code></pre>
<div id="how-data-is-read-and-handled" class="section level2">
<h2>How data is read and handled</h2>
<p>The R site we are creating here uses a separate devleopment, <code>core.R</code> to read in and handle core data. This document then references into the core R development when needed for different code chunks. This allows us for easy scripting and exploration in the R session while also neatly handling dissemination in a document like this.</p>
<p>We first need a couple of libraries</p>
<pre class="r"><code>library(tidyverse)
library(lubridate)</code></pre>
<p>Where the Dashboard data is stored in ISO8859-1 format, the core data is already in UTF-8. So they are way easier to read. We can just point tidyverse’s <code>readr</code> package directly to the data at hand. Start by setting up a core path</p>
<pre class="r"><code>path &lt;- &quot;./data/core&quot;</code></pre>
<div id="case-estimation-of-rt" class="section level3">
<h3>Case Estimation of R<sub>t</sub></h3>
<p>Read in the R<sub>t</sub> case estimation data</p>
<pre class="r"><code>rt_cases_path &lt;- sprintf(&quot;%s/Rt_cases_%s.csv&quot;, path, rt_date)
rt_cases &lt;- readr::read_csv2(rt_cases_path)
rt_cases</code></pre>
<pre><code>## # A tibble: 668 × 4
##    SampleDate estimate uncertainty_lower uncertainty_upper
##    &lt;date&gt;        &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
##  1 2020-03-26      0.9               0.6               1.1
##  2 2020-03-27      0.9               0.6               1.1
##  3 2020-03-28      0.8               0.6               1  
##  4 2020-03-29      0.8               0.6               1  
##  5 2020-03-30      0.8               0.6               1  
##  6 2020-03-31      0.8               0.6               1  
##  7 2020-04-01      0.8               0.6               1  
##  8 2020-04-02      0.8               0.6               0.9
##  9 2020-04-03      0.8               0.6               1  
## 10 2020-04-04      0.8               0.6               1  
## # … with 658 more rows</code></pre>
</div>
<div id="municipality-cases-and-tests-as-a-time-series" class="section level3">
<h3>Municipality cases and tests as a time series</h3>
<p>This data is easily read:</p>
<pre class="r"><code>m_cases_timeseries_path &lt;- sprintf(&quot;%s/Municipality_cases_time_series.csv&quot;, path)
m_cases_timeseries &lt;- readr::read_csv2(m_cases_timeseries_path)
m_cases_timeseries</code></pre>
<pre><code>## # A tibble: 707 × 101
##    SampleDate Roskilde Copenhagen Aarhus Frederiksberg Kalundborg Middelfart
##    &lt;date&gt;        &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1 2020-02-26        1          0      0             0          0          0
##  2 2020-02-27        0          1      0             0          0          0
##  3 2020-02-28        0          0      1             0          0          0
##  4 2020-03-01        0          1      0             0          0          0
##  5 2020-03-02        0          1      0             1          1          1
##  6 2020-03-03        0          4      0             0          0          0
##  7 2020-03-04        0          1      0             0          0          0
##  8 2020-03-05        0          2      0             2          0          0
##  9 2020-03-06        0          0      0             0          0          0
## 10 2020-03-07        0          1      1             1          0          0
## # … with 697 more rows, and 94 more variables: Gentofte &lt;dbl&gt;, Solrød &lt;dbl&gt;,
## #   Allerød &lt;dbl&gt;, Dragør &lt;dbl&gt;, Helsingør &lt;dbl&gt;, Hillerød &lt;dbl&gt;,
## #   Rudersdal &lt;dbl&gt;, Næstved &lt;dbl&gt;, Aalborg &lt;dbl&gt;, Vallensbæk &lt;dbl&gt;,
## #   Esbjerg &lt;dbl&gt;, Favrskov &lt;dbl&gt;, Frederikssund &lt;dbl&gt;, Furesø &lt;dbl&gt;,
## #   Greve &lt;dbl&gt;, Holbæk &lt;dbl&gt;, Kolding &lt;dbl&gt;, Odense &lt;dbl&gt;, Silkeborg &lt;dbl&gt;,
## #   Skanderborg &lt;dbl&gt;, Vejle &lt;dbl&gt;, Aabenraa &lt;dbl&gt;, Ballerup &lt;dbl&gt;,
## #   Egedal &lt;dbl&gt;, Faxe &lt;dbl&gt;, Fredericia &lt;dbl&gt;, Faaborg-Midtfyn &lt;dbl&gt;, …</code></pre>
<p>However, as we see, the data is <em>messy</em> and not <em>tidy</em>. To make the data set tidy, we want to bring it on essentially 3rd normal form:</p>
<pre class="r"><code>m_cases_timeseries &lt;- m_cases_timeseries %&gt;%
  pivot_longer(cols = -c(`SampleDate`), names_to=&quot;Municipality&quot;, values_to=&quot;Cases&quot;) %&gt;%
  rename(date = `SampleDate`)

m_cases_timeseries</code></pre>
<pre><code>## # A tibble: 70,700 × 3
##    date       Municipality  Cases
##    &lt;date&gt;     &lt;chr&gt;         &lt;dbl&gt;
##  1 2020-02-26 Roskilde          1
##  2 2020-02-26 Copenhagen        0
##  3 2020-02-26 Aarhus            0
##  4 2020-02-26 Frederiksberg     0
##  5 2020-02-26 Kalundborg        0
##  6 2020-02-26 Middelfart        0
##  7 2020-02-26 Gentofte          0
##  8 2020-02-26 Solrød            0
##  9 2020-02-26 Allerød           0
## 10 2020-02-26 Dragør            0
## # … with 70,690 more rows</code></pre>
<p>We use the same strategy for the tests:</p>
<pre class="r"><code>m_tested_timeseries_path &lt;- sprintf(&quot;%s/Municipality_tested_persons_time_series.csv&quot;, path)
m_tested_timeseries &lt;- readr::read_csv2(m_tested_timeseries_path)
m_tested_timeseries &lt;- m_tested_timeseries %&gt;%
  pivot_longer(cols = -c(`PrDate_adjusted`), names_to=&quot;Municipality&quot;, values_to=&quot;Tested&quot;) %&gt;%
  rename(date = `PrDate_adjusted`)</code></pre>
<p>Since these two tibbles are storing the same data, we can join them:</p>
<pre class="r"><code>municipality &lt;- m_cases_timeseries %&gt;% left_join(m_tested_timeseries, by = c(&quot;date&quot;, &quot;Municipality&quot;))
municipality &lt;- municipality %&gt;% mutate(Municipality = factor(Municipality))
municipality</code></pre>
<pre><code>## # A tibble: 70,700 × 4
##    date       Municipality  Cases Tested
##    &lt;date&gt;     &lt;fct&gt;         &lt;dbl&gt;  &lt;dbl&gt;
##  1 2020-02-26 Roskilde          1      3
##  2 2020-02-26 Copenhagen        0      4
##  3 2020-02-26 Aarhus            0      2
##  4 2020-02-26 Frederiksberg     0      1
##  5 2020-02-26 Kalundborg        0      0
##  6 2020-02-26 Middelfart        0      0
##  7 2020-02-26 Gentofte          0      0
##  8 2020-02-26 Solrød            0      0
##  9 2020-02-26 Allerød           0      0
## 10 2020-02-26 Dragør            0      0
## # … with 70,690 more rows</code></pre>
</div>
</div>
<div id="plots-of-interest" class="section level2">
<h2>Plots of interest</h2>
<div id="cases-in-different-municipalities" class="section level3">
<h3>Cases in different municipalities</h3>
<p>Generally, the most recent observations in the data sets are flawed. Their counts tend to increase over time as data is reported into the central register. Hence, it is wise to cut these data from the data set and look at the remaining data instead.</p>
<pre class="r"><code>high_cutoff &lt;- max(municipality$date) - days(2)</code></pre>
<p>Furthermore, the we have few observations from island-data. Because of this, it is wise to filter them out, so we can get a better picture of the remaining municipalities. Split off these data sets into their own:</p>
<pre class="r"><code>islands &lt;- c(&quot;Christiansø&quot;, &quot;Fanø&quot;, &quot;Læsø&quot;, &quot;Samsø&quot;)
municipality_islands &lt;- municipality %&gt;% filter(Municipality %in% islands)
municipality &lt;- municipality %&gt;% filter(!Municipality %in% islands)</code></pre>
<p>Plot for the “mainland”</p>
<pre class="r"><code>p &lt;- ggplot(municipality %&gt;% filter(date &gt; low_cutoff, date &lt;= high_cutoff, Municipality != &#39;NA&#39;),
            aes(date, forcats::fct_rev(Municipality), fill=Cases/Tested))
p + geom_tile() +
    scale_fill_continuous(type = &quot;viridis&quot;) +
    labs(title = &quot;Positive Rate split by Municipality (Excluding Islands)&quot;,
         subtitle = &quot;Christmas contributes to positive rate&quot;,
         caption = &quot;Source: ssi.dk&quot;,
         x=&quot;Date&quot;,
         y = &quot;Municipality&quot;)</code></pre>
<p><img src="core_files/figure-html/m_plot_rate-1.png" width="672" /></p>
<p>Plot for the islands</p>
<pre class="r"><code>p &lt;- ggplot(municipality_islands %&gt;% filter(date &gt; low_cutoff, date &lt;= high_cutoff, Municipality != &#39;NA&#39;),
            aes(date, forcats::fct_rev(Municipality), fill=Cases/Tested))
p + geom_tile() +
    scale_fill_continuous(type = &quot;viridis&quot;) +
    labs(title = &quot;Positive Rate split by Municipality (Islands only)&quot;,
         subtitle = &quot;Christmas contributes to positive rate&quot;,
         caption = &quot;Source: ssi.dk&quot;,
         x=&quot;Date&quot;,
         y = &quot;Municipality&quot;)</code></pre>
<p><img src="core_files/figure-html/m_plot_rate_islands-1.png" width="672" /></p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
